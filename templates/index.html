<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì–‘í•œë¹ˆ ì´ë ¥ì„œ ë°ì´í„° ê´€ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .tabs {
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            border-bottom: 3px solid transparent;
            margin-right: 5px;
        }

        .tab-btn:hover {
            background: #f9f9f9;
        }

        .tab-btn.active {
            color: #2196F3;
            border-bottom-color: #2196F3;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0 10px 0;
            color: #333;
            border-left: 4px solid #2196F3;
            padding-left: 10px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 13px;
        }

        .data-table th {
            background: #f0f0f0;
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: #333;
        }

        .data-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        .data-table tr:hover {
            background: #f9f9f9;
        }

        .action-buttons {
            margin: 15px 0;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            font-size: 13px;
            margin-right: 5px;
            border-radius: 3px;
        }

        .btn:hover {
            background: #f5f5f5;
        }

        .btn-primary {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }

        .btn-primary:hover {
            background: #1976D2;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-edit {
            background: #FF9800;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 12px;
            margin-right: 5px;
        }

        .btn-edit:hover {
            background: #F57C00;
        }

        .btn-delete {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 12px;
        }

        .btn-delete:hover {
            background: #d32f2f;
        }

        .cover-letter-item {
            background: white;
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .cover-letter-item h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }

        .cover-letter-item .meta {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .cover-letter-item .question {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #2196F3;
        }

        .cover-letter-item textarea {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-family: inherit;
            font-size: 14px;
        }

        .info-box {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 15px 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 5px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 13px;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .btn-danger {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .action-cell {
            white-space: nowrap;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
            margin: 0 2px;
        }

        /* ì»¤ìŠ¤í…€ í•„ë“œ ìŠ¤íƒ€ì¼ */
        .custom-fields-container {
            border-top: 1px dashed #ddd;
            margin-top: 15px;
            padding-top: 15px;
        }

        .custom-field-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .custom-field-row input {
            flex: 1;
        }

        .custom-field-row .field-name {
            flex: 0.4;
        }

        .custom-field-row .field-value {
            flex: 0.6;
        }

        .btn-remove-field {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 12px;
        }

        .btn-remove-field:hover {
            background: #d32f2f;
        }

        .btn-add-field {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 13px;
            margin-top: 10px;
        }

        .btn-add-field:hover {
            background: #45a049;
        }

        .custom-fields-title {
            font-size: 14px;
            font-weight: bold;
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ì–‘í•œë¹ˆ ì´ë ¥ì„œ ë°ì´í„° ê´€ë¦¬</h1>
        <div class="subtitle">ë³µì‚¬-ë¶™ì—¬ë„£ê¸° ê°€ëŠ¥í•œ í‘œ í˜•ì‹ ë°ì´í„° ê´€ë¦¬</div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('grades')">ì„±ì  ë°ì´í„°</button>
            <button class="tab-btn" onclick="showTab('certifications')">ìê²©ì¦</button>
            <button class="tab-btn" onclick="showTab('awards')">ìˆ˜ìƒ</button>
            <button class="tab-btn" onclick="showTab('activities')">í™œë™</button>
            <button class="tab-btn" onclick="showTab('projects')">í”„ë¡œì íŠ¸</button>
            <button class="tab-btn" onclick="showTab('career')">ê²½ë ¥</button>
            <button class="tab-btn" onclick="showTab('archives')">ì•„ì¹´ì´ë¸Œ</button>
            <button class="tab-btn" onclick="showTab('cover-letters')">ìì†Œì„œ ë¬¸í•­</button>
        </div>

        <!-- ì„±ì  ë°ì´í„° íƒ­ -->
        <div id="grades" class="tab-content active">
            <div class="section-title">ì „ì²´ ì„±ì  (ë¶€ì‚°ëŒ€í•™êµ)</div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="openAddModal('grade')">â• ì„±ì  ì¶”ê°€</button>
                <button class="btn btn-primary" onclick="copyTable('grades-table')">ğŸ“‹ í‘œ ë³µì‚¬</button>
                <button class="btn btn-success" onclick="downloadExcel('grades')">ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
            </div>
            <div id="grades-content">
                <table class="data-table" id="grades-table">
                    <thead>
                        <tr>
                            <th>í•™ë…„ë„</th>
                            <th>í•™ê¸°</th>
                            <th>ì„±ì ë¶„ë¥˜</th>
                            <th>êµê³¼êµ¬ë¶„</th>
                            <th>êµê³¼ëª©ëª…</th>
                            <th>í•™ì </th>
                            <th>ì„±ì ë“±ê¸‰</th>
                            <th>ë¹„ê³ </th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody id="grades-tbody">
                        <tr><td colspan="9" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ìê²©ì¦ íƒ­ -->
        <div id="certifications" class="tab-content">
            <div class="section-title">ìê²©ì¦ ì •ë³´</div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="openAddModal('cert')">â• ìê²©ì¦ ì¶”ê°€</button>
                <button class="btn btn-primary" onclick="copyTable('cert-table')">ğŸ“‹ í‘œ ë³µì‚¬</button>
                <button class="btn btn-success" onclick="downloadExcel('certifications')">ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
            </div>
            <table class="data-table" id="cert-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>ìê²©ì¦ëª…</th>
                        <th>ë“±ê¸‰</th>
                        <th>ë°œí–‰ì²˜</th>
                        <th>ì·¨ë“ì¼</th>
                        <th>ìê²©ì¦ë²ˆí˜¸</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="cert-tbody">
                    <tr><td colspan="7" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- ìˆ˜ìƒ íƒ­ -->
        <div id="awards" class="tab-content">
            <div class="section-title">ìˆ˜ìƒ ë‚´ì—­</div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="copyTable('awards-table')">ğŸ“‹ í‘œ ë³µì‚¬</button>
                <button class="btn btn-success" onclick="downloadExcel('awards')">ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
            </div>
            <table class="data-table" id="awards-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>ìˆ˜ìƒëª…</th>
                        <th>ìˆ˜ì—¬ê¸°ê´€</th>
                        <th>ìˆ˜ìƒì¼ì</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="awards-tbody">
                    <tr><td colspan="5" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- í™œë™ íƒ­ -->
        <div id="activities" class="tab-content">
            <div class="section-title">ëŒ€ë‚´ì™¸ í™œë™</div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="copyTable('activities-table')">ğŸ“‹ í‘œ ë³µì‚¬</button>
                <button class="btn btn-success" onclick="downloadExcel('activities')">ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
            </div>
            <table class="data-table" id="activities-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>í™œë™ëª…</th>
                        <th>ì£¼ê´€ê¸°ê´€</th>
                        <th>ì‹œì‘ì¼</th>
                        <th>ì¢…ë£Œì¼</th>
                        <th>ë‚´ìš©</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="activities-tbody">
                    <tr><td colspan="7" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- í”„ë¡œì íŠ¸ íƒ­ -->
        <div id="projects" class="tab-content">
            <div class="section-title">í”„ë¡œì íŠ¸ ê²½í—˜</div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="copyTable('projects-table')">ğŸ“‹ í‘œ ë³µì‚¬</button>
                <button class="btn btn-success" onclick="downloadExcel('projects')">ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
            </div>
            <table class="data-table" id="projects-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>í”„ë¡œì íŠ¸ëª…</th>
                        <th>ê¸°ê°„</th>
                        <th>ì¸ì›</th>
                        <th>ì—­í• </th>
                        <th>ê¸°ìˆ ìŠ¤íƒ</th>
                        <th>ì„¤ëª…</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="projects-tbody">
                    <tr><td colspan="8" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- ê²½ë ¥ íƒ­ -->
        <div id="career" class="tab-content">
            <div class="section-title">ê²½ë ¥ ì‚¬í•­</div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="copyTable('career-table')">ğŸ“‹ í‘œ ë³µì‚¬</button>
                <button class="btn btn-success" onclick="downloadExcel('career')">ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
            </div>
            <table class="data-table" id="career-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>ê¸°ì—…ëª…</th>
                        <th>ì§ê¸‰</th>
                        <th>ì…ì‚¬ì¼</th>
                        <th>í‡´ì‚¬ì¼</th>
                        <th>ë‹´ë‹¹ì—…ë¬´</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="career-tbody">
                    <tr><td colspan="7" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- ì•„ì¹´ì´ë¸Œ íƒ­ -->
        <div id="archives" class="tab-content">
            <div class="section-title">ê³µì‹ ë¬¸ì„œ ì•„ì¹´ì´ë¸Œ</div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="openArchiveUploadModal()">ğŸ“ íŒŒì¼ ì—…ë¡œë“œ</button>
                <select id="archive-filter" onchange="filterArchives()" style="padding: 8px; margin-left: 10px;">
                    <option value="">ì „ì²´ ë³´ê¸°</option>
                    <option value="ì„±ì ì¦ëª…ì„œ">ì„±ì ì¦ëª…ì„œ</option>
                    <option value="ì¡¸ì—…ì¦ëª…ì„œ">ì¡¸ì—…ì¦ëª…ì„œ</option>
                    <option value="ìˆ˜ë£Œì¦">ìˆ˜ë£Œì¦</option>
                    <option value="ìê²©ì¦">ìê²©ì¦</option>
                    <option value="ì¬ì§ì¦ëª…ì„œ">ì¬ì§ì¦ëª…ì„œ</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
            </div>
            <table class="data-table" id="archives-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>ë¬¸ì„œëª…</th>
                        <th>ì¹´í…Œê³ ë¦¬</th>
                        <th>íŒŒì¼ëª…</th>
                        <th>ì„¤ëª…</th>
                        <th>ì—…ë¡œë“œì¼</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="archives-tbody">
                    <tr><td colspan="7" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- ìì†Œì„œ ë¬¸í•­ íƒ­ -->
        <div id="cover-letters" class="tab-content">
            <div class="section-title">ìê¸°ì†Œê°œì„œ ë¬¸í•­ ê´€ë¦¬</div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="openAddCoverLetterModal()">â• ë¬¸í•­ ì¶”ê°€</button>
                <select id="cover-letter-filter" onchange="filterCoverLetters()" style="padding: 8px; margin-left: 10px;">
                    <option value="">ì „ì²´ ë³´ê¸°</option>
                    <option value="ì§€ì›ë™ê¸°">ì§€ì›ë™ê¸°</option>
                    <option value="ì„±ì¥ê³¼ì •">ì„±ì¥ê³¼ì •</option>
                    <option value="ì„±ê²©/ì¥ë‹¨ì ">ì„±ê²©/ì¥ë‹¨ì </option>
                    <option value="ê°ˆë“±ê²½í—˜">ê°ˆë“±ê²½í—˜</option>
                    <option value="í˜‘ì—…ê²½í—˜">í˜‘ì—…ê²½í—˜</option>
                    <option value="ë¬¸ì œí•´ê²°">ë¬¸ì œí•´ê²°</option>
                    <option value="ì‹¤íŒ¨ê²½í—˜">ì‹¤íŒ¨ê²½í—˜</option>
                    <option value="ëª©í‘œ/ë¹„ì „">ëª©í‘œ/ë¹„ì „</option>
                    <option value="ì§ë¬´ì—­ëŸ‰">ì§ë¬´ì—­ëŸ‰</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
            </div>
            <div id="cover-letter-list"></div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="modal-title">ë°ì´í„° ì¶”ê°€</div>
            <div id="modal-body"></div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveData()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        // ì„±ì  ë°ì´í„° (ì„±ì ì¦ëª…ì„œ ê¸°ë°˜)
        const gradesData = [
            {year: '2019', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘ì„ íƒ', subject: 'ì„¸ê³„ë¬¸í™”ìœ ì‚°ì˜ì´í•´', credit: '3.0', grade: 'C+', note: '1ì˜ì—­ : ì‚¬ìƒê³¼ì—­ì‚¬'},
            {year: '2019', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘ì„ íƒ', subject: 'ì²´í—˜ê´€ê´‘ê³¼ ë™.ì„œì–‘ ë¬¸í™” ì´í•´', credit: '3.0', grade: 'C0', note: '2ì˜ì—­ : ì‚¬íšŒì™€ë¬¸í™”'},
            {year: '2019', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘í•„ìˆ˜', subject: 'ê³ ì „ì½ê¸°ì™€í† ë¡ ', credit: '2.0', grade: 'B+', note: ''},
            {year: '2019', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µê¸°ì´ˆ', subject: 'ê²½ì˜ê³¼ ì¸ì„±', credit: '1.0', grade: 'S', note: ''},
            {year: '2019', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µê¸°ì´ˆ', subject: 'ê²½ì œí•™ì›ë¡ ', credit: '3.0', grade: 'A0', note: ''},
            {year: '2019', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘ì„ íƒ', subject: 'ìš•ë§ê³¼ì² í•™', credit: '3.0', grade: 'A+', note: '1ì˜ì—­ : ì‚¬ìƒê³¼ì—­ì‚¬'},
            {year: '2019', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘í•„ìˆ˜', subject: 'ì—´ë¦°ì‚¬ê³ ì™€í‘œí˜„', credit: '2.0', grade: 'B+', note: ''},
            {year: '2019', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘í•„ìˆ˜', subject: 'ì»´í“¨íŒ…ì‚¬ê³ ', credit: '1.5', grade: 'B+', note: ''},
            {year: '2019', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µê¸°ì´ˆ', subject: 'ê²½ì˜í†µê³„í•™', credit: '3.0', grade: 'A0', note: ''},
            {year: '2019', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µê¸°ì´ˆ', subject: 'íšŒê³„í•™ì›ë¦¬', credit: '3.0', grade: 'A0', note: ''},
            {year: '2022', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘ì„ íƒ', subject: 'ì˜ì–´í‘œí˜„ì—°ìŠµ(I)', credit: '3.0', grade: 'B+', note: '6ì˜ì—­ : ì™¸êµ­ì–´'},
            {year: '2022', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘ì„ íƒ', subject: 'ì¸ê°„í–‰ë™ê³¼ì‹¬ë¦¬', credit: '3.0', grade: 'C+', note: '2ì˜ì—­ : ì‚¬íšŒì™€ë¬¸í™”'},
            {year: '2022', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘í•„ìˆ˜', subject: 'ëŒ€í•™ì‹¤ìš©ì˜ì–´(II)', credit: '2.0', grade: 'A+', note: ''},
            {year: '2022', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µê¸°ì´ˆ', subject: 'ê²½ì˜í•™ì›ë¡ ', credit: '3.0', grade: 'B0', note: ''},
            {year: '2022', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µí•„ìˆ˜', subject: 'ë§ˆì¼€íŒ…ê´€ë¦¬', credit: '3.0', grade: 'B+', note: ''},
            {year: '2022', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µí•„ìˆ˜', subject: 'ì˜¤í¼ë ˆì´ì…˜ìŠ¤ ë§¤ë‹ˆì§€ë¨¼íŠ¸', credit: '3.0', grade: 'A+', note: ''},
            {year: '2022', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µí•„ìˆ˜', subject: 'ì¬ë¬´íšŒê³„(I)', credit: '3.0', grade: 'A0', note: ''},
            {year: '2022', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘ì„ íƒ', subject: 'ê·¼ë ¥íŠ¸ë ˆì´ë‹ì²˜ë°©', credit: '1.5', grade: 'A0', note: '5ì˜ì—­ : ê±´ê°•ê³¼ë ˆí¬ì¸ '},
            {year: '2022', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µì„ íƒ', subject: 'ê´‘ê³ ë¡ ', credit: '3.0', grade: 'B+', note: ''},
            {year: '2022', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µì„ íƒ', subject: 'ë°ì´í„°ë² ì´ìŠ¤ê´€ë¦¬', credit: '3.0', grade: 'C+', note: ''},
            {year: '2022', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µì„ íƒ', subject: 'ì°½ì—…ê³¼ê¸°ì—…ê°€ì •ì‹ ', credit: '3.0', grade: 'B+', note: ''},
            {year: '2022', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µí•„ìˆ˜', subject: 'ì¸ì ìì›ê´€ë¦¬', credit: '3.0', grade: 'B+', note: ''},
            {year: '2022', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µí•„ìˆ˜', subject: 'ì¬ë¬´ê´€ë¦¬', credit: '3.0', grade: 'B+', note: ''},
            {year: '2023', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘ì„ íƒ', subject: 'ê¸°ì—…ê°€ì •ì‹ ê³¼ ì°½ì˜ì  ì‚¬ê³ ', credit: '2.0', grade: 'S', note: '7ì˜ì—­ : ìœµë³µí•©'},
            {year: '2023', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ë¶€ì „ê³µ', subject: 'ì˜ìƒë§¤ì²´ì´ë¡ ', credit: '3.0', grade: 'B+', note: ''},
            {year: '2023', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ë¶€ì „ê³µ', subject: 'ì˜í™”í•™ì…ë¬¸', credit: '3.0', grade: 'B+', note: ''},
            {year: '2023', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µì„ íƒ', subject: 'êµ­ì œì•„ì›ƒì†Œì‹±ì „ëµ', credit: '3.0', grade: 'B+', note: ''},
            {year: '2023', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µì„ íƒ', subject: 'ì†Œë¹„ìí–‰ë™ë¡ ', credit: '3.0', grade: 'A+', note: ''},
            {year: '2023', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µí•„ìˆ˜', subject: 'íˆ¬ìë¡ ', credit: '3.0', grade: 'A0', note: ''},
            {year: '2023', semester: 'ì—¬ë¦„', type: 'ê³„ì ˆìˆ˜ì—…', category: 'êµì–‘í•„ìˆ˜', subject: 'ê¸°ì´ˆì»´í“¨í„°í”„ë¡œê·¸ë˜ë°', credit: '1.5', grade: 'A+', note: ''},
            {year: '2023', semester: 'ì—¬ë¦„', type: 'ê³„ì ˆìˆ˜ì—…', category: 'ì „ê³µí•„ìˆ˜', subject: 'êµ­ì œê²½ì˜í•™', credit: '3.0', grade: 'B+', note: ''},
            {year: '2023', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ë¶€ì „ê³µ', subject: 'ì˜ˆìˆ ì‚¬ì¡°ì™€ì˜ˆìˆ ìš´ë™', credit: '3.0', grade: 'C+', note: ''},
            {year: '2023', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ë¶€ì „ê³µ', subject: 'í•œêµ­ì˜í™”ì˜ ì—­ì‚¬ì™€ ì „ë§', credit: '3.0', grade: 'B+', note: ''},
            {year: '2023', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì¼ë°˜ì„ íƒ', subject: 'ëŒ€ì¸ê´€ê³„ëŠ¥ë ¥ê³¼ì˜ì‚¬ì†Œí†µê¸°ìˆ ', credit: '3.0', grade: 'S', note: ''},
            {year: '2023', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì¼ë°˜ì„ íƒ', subject: 'ì§„ë¡œíƒìƒ‰ê³¼ ìƒì• ì„¤ê³„', credit: '3.0', grade: 'S', note: ''},
            {year: '2023', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µì„ íƒ', subject: 'ë¹…ë°ì´í„°ë¹„ì¦ˆë‹ˆìŠ¤', credit: '3.0', grade: 'C+', note: ''},
            {year: '2023', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µí•„ìˆ˜', subject: 'ê´€ë¦¬íšŒê³„', credit: '3.0', grade: 'B+', note: ''},
            {year: '2024', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'êµì–‘ì„ íƒ', subject: 'ì„±ê³¼ì‚¬ë‘ì˜ì² í•™', credit: '3.0', grade: 'A+', note: '2ì˜ì—­ : ì‚¬íšŒì™€ë¬¸í™”'},
            {year: '2024', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ë¶€ì „ê³µ', subject: 'ì˜ˆìˆ ê²½ì˜ì…ë¬¸', credit: '3.0', grade: 'B+', note: ''},
            {year: '2024', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì¼ë°˜ì„ íƒ', subject: 'ì·¨ì—…ì‹¤ì „ì „ëµ(I)-ìê¸°ì†Œê°œì„œë°ë©´ì ‘ì¤€ë¹„ë²•', credit: '3.0', grade: 'S', note: ''},
            {year: '2024', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì¼ë°˜ì„ íƒ', subject: 'PNU TOEFLê¸°ì´ˆ', credit: '3.0', grade: 'S', note: ''},
            {year: '2024', semester: '2í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µì„ íƒ', subject: 'ì¡°ì§í–‰ìœ„ë¡ ', credit: '3.0', grade: 'A0', note: ''},
            {year: '2025', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ë¶€ì „ê³µ', subject: 'ë¯¸í•™ì…ë¬¸', credit: '3.0', grade: 'B+', note: ''},
            {year: '2025', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ë¶€ì „ê³µ', subject: 'ì„¸ê³„ì˜í™”ì˜ ì—­ì‚¬ì™€ ì „ë§', credit: '3.0', grade: 'C+', note: ''},
            {year: '2025', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì¼ë°˜ì„ íƒ', subject: 'ë…¼ë¦¬ì ì‚¬ê³ ì™€ìˆ˜ë¦¬', credit: '3.0', grade: 'S', note: ''},
            {year: '2025', semester: '1í•™ê¸°', type: 'ì •ê·œí•™ê¸°', category: 'ì „ê³µí•„ìˆ˜', subject: 'ê²½ì˜ì •ë³´ì‹œìŠ¤í…œ', credit: '3.0', grade: 'C+', note: ''}
        ];

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // ê° íƒ­ ë¡œë“œ
            if (tabName === 'grades') loadGrades();
            else if (tabName === 'certifications') loadCertifications();
            else if (tabName === 'awards') loadAwards();
            else if (tabName === 'activities') loadActivities();
            else if (tabName === 'projects') loadProjects();
            else if (tabName === 'career') loadCareer();
            else if (tabName === 'archives') loadArchives();
            else if (tabName === 'cover-letters') loadCoverLettersFromDB();
        }

        // ì „ì—­ ë³€ìˆ˜
        let currentEditType = '';
        let currentEditIndex = -1;
        let currentEditId = -1;

        // ì„±ì  ë°ì´í„° ë¡œë“œ
        function loadGrades() {
            const tbody = document.getElementById('grades-tbody');
            let html = '';
            gradesData.forEach((row, idx) => {
                html += `
                    <tr>
                        <td>${row.year}</td>
                        <td>${row.semester}</td>
                        <td>${row.type}</td>
                        <td>${row.category}</td>
                        <td>${row.subject}</td>
                        <td>${row.credit}</td>
                        <td>${row.grade}</td>
                        <td>${row.note}</td>
                        <td class="action-cell">
                            <button class="btn btn-small" onclick="editGrade(${idx})">âœï¸</button>
                            <button class="btn btn-small btn-danger" onclick="deleteGrade(${idx})">ğŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        // ì„±ì  ìˆ˜ì •
        function editGrade(idx) {
            currentEditType = 'grade';
            currentEditIndex = idx;
            const data = gradesData[idx];

            document.getElementById('modal-title').textContent = 'ì„±ì  ìˆ˜ì •';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>í•™ë…„ë„</label>
                    <input type="text" id="edit-year" value="${data.year}">
                </div>
                <div class="form-group">
                    <label>í•™ê¸°</label>
                    <input type="text" id="edit-semester" value="${data.semester}">
                </div>
                <div class="form-group">
                    <label>ì„±ì ë¶„ë¥˜</label>
                    <input type="text" id="edit-type" value="${data.type}">
                </div>
                <div class="form-group">
                    <label>êµê³¼êµ¬ë¶„</label>
                    <input type="text" id="edit-category" value="${data.category}">
                </div>
                <div class="form-group">
                    <label>êµê³¼ëª©ëª…</label>
                    <input type="text" id="edit-subject" value="${data.subject}">
                </div>
                <div class="form-group">
                    <label>í•™ì </label>
                    <input type="text" id="edit-credit" value="${data.credit}">
                </div>
                <div class="form-group">
                    <label>ì„±ì ë“±ê¸‰</label>
                    <input type="text" id="edit-grade" value="${data.grade}">
                </div>
                <div class="form-group">
                    <label>ë¹„ê³ </label>
                    <input type="text" id="edit-note" value="${data.note}">
                </div>
            `;
            document.getElementById('modal').classList.add('active');
        }

        // ì„±ì  ì‚­ì œ
        function deleteGrade(idx) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                gradesData.splice(idx, 1);
                loadGrades();
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ëª¨ë‹¬ ì—´ê¸°
        function openAddModal(type) {
            currentEditType = type;
            currentEditIndex = -1;

            if (type === 'grade') {
                document.getElementById('modal-title').textContent = 'ì„±ì  ì¶”ê°€';
                document.getElementById('modal-body').innerHTML = `
                    <div class="form-group">
                        <label>í•™ë…„ë„</label>
                        <input type="text" id="edit-year" placeholder="ì˜ˆ: 2025">
                    </div>
                    <div class="form-group">
                        <label>í•™ê¸°</label>
                        <input type="text" id="edit-semester" placeholder="ì˜ˆ: 1í•™ê¸°">
                    </div>
                    <div class="form-group">
                        <label>ì„±ì ë¶„ë¥˜</label>
                        <input type="text" id="edit-type" value="ì •ê·œí•™ê¸°">
                    </div>
                    <div class="form-group">
                        <label>êµê³¼êµ¬ë¶„</label>
                        <select id="edit-category">
                            <option>êµì–‘ì„ íƒ</option>
                            <option>êµì–‘í•„ìˆ˜</option>
                            <option>ì „ê³µì„ íƒ</option>
                            <option>ì „ê³µí•„ìˆ˜</option>
                            <option>ì „ê³µê¸°ì´ˆ</option>
                            <option>ë¶€ì „ê³µ</option>
                            <option>ì¼ë°˜ì„ íƒ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>êµê³¼ëª©ëª…</label>
                        <input type="text" id="edit-subject">
                    </div>
                    <div class="form-group">
                        <label>í•™ì </label>
                        <input type="text" id="edit-credit" placeholder="ì˜ˆ: 3.0">
                    </div>
                    <div class="form-group">
                        <label>ì„±ì ë“±ê¸‰</label>
                        <select id="edit-grade">
                            <option>A+</option>
                            <option>A0</option>
                            <option>B+</option>
                            <option>B0</option>
                            <option>C+</option>
                            <option>C0</option>
                            <option>D+</option>
                            <option>D0</option>
                            <option>F</option>
                            <option>S</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ë¹„ê³ </label>
                        <input type="text" id="edit-note" placeholder="ì„ íƒì‚¬í•­">
                    </div>
                `;
            } else if (type === 'cert') {
                document.getElementById('modal-title').textContent = 'ìê²©ì¦ ì¶”ê°€';
                document.getElementById('modal-body').innerHTML = `
                    <div class="form-group">
                        <label>ìê²©ì¦ëª…</label>
                        <input type="text" id="edit-cert-name">
                    </div>
                    <div class="form-group">
                        <label>ë“±ê¸‰</label>
                        <input type="text" id="edit-cert-grade" placeholder="ì˜ˆ: 1ê¸‰, 2ê¸‰ ë˜ëŠ” -">
                    </div>
                    <div class="form-group">
                        <label>ë°œí–‰ì²˜</label>
                        <input type="text" id="edit-cert-issuer">
                    </div>
                    <div class="form-group">
                        <label>ì·¨ë“ì¼</label>
                        <input type="text" id="edit-cert-date" placeholder="ì˜ˆ: 2025-12">
                    </div>
                    <div class="form-group">
                        <label>ìê²©ì¦ë²ˆí˜¸</label>
                        <input type="text" id="edit-cert-number">
                    </div>
                `;
            }

            document.getElementById('modal').classList.add('active');
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            currentEditType = '';
            currentEditIndex = -1;
        }

        // ë°ì´í„° ì €ì¥
        function saveData() {
            if (currentEditType === 'grade') {
                const newData = {
                    year: document.getElementById('edit-year').value,
                    semester: document.getElementById('edit-semester').value,
                    type: document.getElementById('edit-type').value,
                    category: document.getElementById('edit-category').value,
                    subject: document.getElementById('edit-subject').value,
                    credit: document.getElementById('edit-credit').value,
                    grade: document.getElementById('edit-grade').value,
                    note: document.getElementById('edit-note').value
                };

                if (currentEditIndex >= 0) {
                    gradesData[currentEditIndex] = newData;
                    alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    gradesData.push(newData);
                    alert('ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                loadGrades();
            } else if (currentEditType === 'cert') {
                // ìê²©ì¦ ì¶”ê°€
                const extraFields = collectCustomFields();
                const data = {
                    name: document.getElementById('edit-cert-name').value,
                    grade: document.getElementById('edit-cert-grade').value || '-',
                    issuer: document.getElementById('edit-cert-issuer').value,
                    date: document.getElementById('edit-cert-date').value,
                    number: document.getElementById('edit-cert-number').value || ''
                };
                if (extraFields) data.extra_fields = extraFields;
                fetch('/api/certifications', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                }).then(r => r.json()).then(() => {
                    alert('ìê²©ì¦ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadCertifications();
                });
            } else if (currentEditType === 'cert-edit') {
                // ìê²©ì¦ ìˆ˜ì •
                const extraFields = collectCustomFields();
                const data = {
                    name: document.getElementById('edit-cert-name').value,
                    grade: document.getElementById('edit-cert-grade').value || '-',
                    issuer: document.getElementById('edit-cert-issuer').value,
                    date: document.getElementById('edit-cert-date').value,
                    number: document.getElementById('edit-cert-number').value || ''
                };
                if (extraFields) data.extra_fields = extraFields;
                fetch(`/api/certifications/${currentEditId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                }).then(r => r.json()).then(() => {
                    alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadCertifications();
                });
            } else if (currentEditType === 'award-edit') {
                // ìˆ˜ìƒ ìˆ˜ì •
                const extraFields = collectCustomFields();
                const data = {
                    name: document.getElementById('edit-award-name').value,
                    organization: document.getElementById('edit-award-org').value,
                    date: document.getElementById('edit-award-date').value
                };
                if (extraFields) data.extra_fields = extraFields;
                fetch(`/api/awards/${currentEditId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                }).then(r => r.json()).then(() => {
                    alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadAwards();
                });
            } else if (currentEditType === 'activity-edit') {
                // í™œë™ ìˆ˜ì •
                const extraFields = collectCustomFields();
                const data = {
                    name: document.getElementById('edit-activity-name').value,
                    organization: document.getElementById('edit-activity-org').value,
                    start_date: document.getElementById('edit-activity-start').value,
                    end_date: document.getElementById('edit-activity-end').value,
                    description: document.getElementById('edit-activity-desc').value
                };
                if (extraFields) data.extra_fields = extraFields;
                fetch(`/api/activities/${currentEditId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                }).then(r => r.json()).then(() => {
                    alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadActivities();
                });
            } else if (currentEditType === 'project-edit') {
                // í”„ë¡œì íŠ¸ ìˆ˜ì •
                const extraFields = collectCustomFields();
                const data = {
                    name: document.getElementById('edit-project-name').value,
                    date: document.getElementById('edit-project-date').value,
                    team_size: document.getElementById('edit-project-team').value,
                    role: document.getElementById('edit-project-role').value,
                    description: document.getElementById('edit-project-desc').value,
                    tech_stack: []
                };
                if (extraFields) data.extra_fields = extraFields;
                fetch(`/api/projects/${currentEditId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                }).then(r => r.json()).then(() => {
                    alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadProjects();
                });
            } else if (currentEditType === 'career-edit') {
                // ê²½ë ¥ ìˆ˜ì •
                const extraFields = collectCustomFields();
                const data = {
                    company: document.getElementById('edit-career-company').value,
                    position: document.getElementById('edit-career-position').value,
                    start_date: document.getElementById('edit-career-start').value,
                    end_date: document.getElementById('edit-career-end').value,
                    description: document.getElementById('edit-career-desc').value
                };
                if (extraFields) data.extra_fields = extraFields;
                fetch(`/api/career/${currentEditId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                }).then(r => r.json()).then(() => {
                    alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadCareer();
                });
            } else if (currentEditType === 'archive-add') {
                // ì•„ì¹´ì´ë¸Œ íŒŒì¼ ì—…ë¡œë“œ
                const fileInput = document.getElementById('archive-file');
                if (!fileInput.files[0]) {
                    alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                formData.append('name', document.getElementById('archive-name').value);
                formData.append('category', document.getElementById('archive-category').value);
                formData.append('description', document.getElementById('archive-desc').value);

                fetch('/api/archives', {
                    method: 'POST',
                    body: formData
                }).then(r => r.json()).then(data => {
                    if (data.success) {
                        alert('íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
                        loadArchives();
                    } else {
                        alert('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    }
                });
            } else if (currentEditType === 'archive-edit') {
                // ì•„ì¹´ì´ë¸Œ ìˆ˜ì •
                const data = {
                    name: document.getElementById('archive-name').value,
                    category: document.getElementById('archive-category').value,
                    description: document.getElementById('archive-desc').value
                };
                fetch(`/api/archives/${currentEditId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                }).then(r => r.json()).then(() => {
                    alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadArchives();
                });
            } else if (currentEditType === 'cover-letter-add') {
                // ìì†Œì„œ ë¬¸í•­ ì¶”ê°€
                const extraFields = collectCustomFields();
                const data = {
                    company: document.getElementById('edit-cl-company').value,
                    position: document.getElementById('edit-cl-position').value,
                    category: document.getElementById('edit-cl-category').value,
                    question: document.getElementById('edit-cl-question').value,
                    char_limit: document.getElementById('edit-cl-char-limit').value || null,
                    answer: ''
                };
                if (extraFields) data.extra_fields = extraFields;
                fetch('/api/cover-letters', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                }).then(r => r.json()).then(() => {
                    alert('ìì†Œì„œ ë¬¸í•­ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadCoverLettersFromDB();
                });
            } else if (currentEditType === 'cover-letter-edit') {
                // ìì†Œì„œ ë¬¸í•­ ìˆ˜ì •
                const extraFields = collectCustomFields();
                const data = {
                    company: document.getElementById('edit-cl-company').value,
                    position: document.getElementById('edit-cl-position').value,
                    category: document.getElementById('edit-cl-category').value,
                    question: document.getElementById('edit-cl-question').value,
                    char_limit: document.getElementById('edit-cl-char-limit').value || null
                };
                if (extraFields) data.extra_fields = extraFields;
                fetch(`/api/cover-letters/${currentEditId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                }).then(r => r.json()).then(() => {
                    alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadCoverLettersFromDB();
                });
            }

            closeModal();
        }

        // ìê²©ì¦ ë¡œë“œ
        function loadCertifications() {
            fetch('/api/certifications')
                .then(r => r.json())
                .then(data => {
                    let html = '';
                    data.forEach((cert, idx) => {
                        const name = (cert.name || '').replace(/'/g, "\\'");
                        const grade = (cert.grade || '').replace(/'/g, "\\'");
                        const issuer = (cert.issuer || '').replace(/'/g, "\\'");
                        const number = (cert.number || '').replace(/'/g, "\\'");
                        const extraFields = (cert.extra_fields || '{}').replace(/'/g, "\\'");
                        html += `
                            <tr>
                                <td>${idx + 1}</td>
                                <td>${cert.name}</td>
                                <td>${cert.grade || '-'}</td>
                                <td>${cert.issuer}</td>
                                <td>${cert.date}</td>
                                <td>${cert.number || '-'}</td>
                                <td>
                                    <button class="btn-edit" onclick="editCert(${cert.id}, '${name}', '${grade}', '${issuer}', '${cert.date}', '${number}', '${extraFields}')">ìˆ˜ì •</button>
                                    <button class="btn-delete" onclick="deleteCert(${cert.id})">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `;
                    });
                    document.getElementById('cert-tbody').innerHTML = html;
                });
        }

        // ìê²©ì¦ ìˆ˜ì •
        function editCert(id, name, grade, issuer, date, number, extraFields = '{}') {
            currentEditType = 'cert-edit';
            currentEditId = id;
            customFieldCounter = 0;

            const extra = typeof extraFields === 'string' ? JSON.parse(extraFields || '{}') : (extraFields || {});

            document.getElementById('modal-title').textContent = 'ìê²©ì¦ ìˆ˜ì •';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>ìê²©ì¦ëª…</label>
                    <input type="text" id="edit-cert-name" value="${name || ''}">
                </div>
                <div class="form-group">
                    <label>ë“±ê¸‰</label>
                    <input type="text" id="edit-cert-grade" value="${grade || ''}" placeholder="ì˜ˆ: 1ê¸‰, 2ê¸‰ ë˜ëŠ” -">
                </div>
                <div class="form-group">
                    <label>ë°œí–‰ì²˜</label>
                    <input type="text" id="edit-cert-issuer" value="${issuer || ''}">
                </div>
                <div class="form-group">
                    <label>ì·¨ë“ì¼</label>
                    <input type="text" id="edit-cert-date" value="${date || ''}" placeholder="ì˜ˆ: 2025-12-19">
                </div>
                <div class="form-group">
                    <label>ìê²©ì¦ë²ˆí˜¸</label>
                    <input type="text" id="edit-cert-number" value="${number || ''}">
                </div>
                ${getCustomFieldsHTML(extra)}
            `;
            document.getElementById('modal').classList.add('active');
        }

        // ìê²©ì¦ ì‚­ì œ
        function deleteCert(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                fetch(`/api/certifications/${id}`, {method: 'DELETE'})
                .then(r => r.json())
                .then(data => {
                    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadCertifications();
                });
            }
        }

        // ìˆ˜ìƒ ë¡œë“œ
        function loadAwards() {
            fetch('/api/awards')
                .then(r => r.json())
                .then(data => {
                    let html = '';
                    data.forEach((award, idx) => {
                        const name = (award.name || '').replace(/'/g, "\\'");
                        const org = (award.organization || '').replace(/'/g, "\\'");
                        const extraFields = (award.extra_fields || '{}').replace(/'/g, "\\'");
                        html += `
                            <tr>
                                <td>${idx + 1}</td>
                                <td>${award.name}</td>
                                <td>${award.organization}</td>
                                <td>${award.date}</td>
                                <td>
                                    <button class="btn-edit" onclick="editAward(${award.id}, '${name}', '${org}', '${award.date}', '${extraFields}')">ìˆ˜ì •</button>
                                    <button class="btn-delete" onclick="deleteAward(${award.id})">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `;
                    });
                    document.getElementById('awards-tbody').innerHTML = html;
                });
        }

        // ìˆ˜ìƒ ìˆ˜ì •
        function editAward(id, name, org, date, extraFields = '{}') {
            currentEditType = 'award-edit';
            currentEditId = id;
            customFieldCounter = 0;

            const extra = typeof extraFields === 'string' ? JSON.parse(extraFields || '{}') : (extraFields || {});

            document.getElementById('modal-title').textContent = 'ìˆ˜ìƒ ìˆ˜ì •';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>ìˆ˜ìƒëª…</label>
                    <input type="text" id="edit-award-name" value="${name || ''}">
                </div>
                <div class="form-group">
                    <label>ìˆ˜ì—¬ê¸°ê´€</label>
                    <input type="text" id="edit-award-org" value="${org || ''}">
                </div>
                <div class="form-group">
                    <label>ìˆ˜ìƒì¼ì</label>
                    <input type="text" id="edit-award-date" value="${date || ''}" placeholder="ì˜ˆ: 2024-12-15">
                </div>
                ${getCustomFieldsHTML(extra)}
            `;
            document.getElementById('modal').classList.add('active');
        }

        // ìˆ˜ìƒ ì‚­ì œ
        function deleteAward(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                fetch(`/api/awards/${id}`, {method: 'DELETE'})
                .then(r => r.json())
                .then(data => {
                    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadAwards();
                });
            }
        }

        // í™œë™ ë¡œë“œ
        function loadActivities() {
            fetch('/api/activities')
                .then(r => r.json())
                .then(data => {
                    let html = '';
                    data.forEach((act, idx) => {
                        const name = (act.name || '').replace(/'/g, "\\'");
                        const org = (act.organization || '').replace(/'/g, "\\'");
                        const desc = (act.description || '').replace(/'/g, "\\'");
                        const extraFields = (act.extra_fields || '{}').replace(/'/g, "\\'");
                        html += `
                            <tr>
                                <td>${idx + 1}</td>
                                <td>${act.name}</td>
                                <td>${act.organization}</td>
                                <td>${act.start_date}</td>
                                <td>${act.end_date}</td>
                                <td>${act.description || '-'}</td>
                                <td>
                                    <button class="btn-edit" onclick="editActivity(${act.id}, '${name}', '${org}', '${act.start_date}', '${act.end_date}', '${desc}', '${extraFields}')">ìˆ˜ì •</button>
                                    <button class="btn-delete" onclick="deleteActivity(${act.id})">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `;
                    });
                    document.getElementById('activities-tbody').innerHTML = html;
                });
        }

        // í™œë™ ìˆ˜ì •
        function editActivity(id, name, org, startDate, endDate, desc, extraFields = '{}') {
            currentEditType = 'activity-edit';
            currentEditId = id;
            customFieldCounter = 0;

            let extra = {};
            try { extra = JSON.parse(extraFields || '{}'); } catch(e) {}

            document.getElementById('modal-title').textContent = 'í™œë™ ìˆ˜ì •';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>í™œë™ëª…</label>
                    <input type="text" id="edit-activity-name" value="${name || ''}">
                </div>
                <div class="form-group">
                    <label>ì£¼ê´€ê¸°ê´€</label>
                    <input type="text" id="edit-activity-org" value="${org || ''}">
                </div>
                <div class="form-group">
                    <label>ì‹œì‘ì¼</label>
                    <input type="text" id="edit-activity-start" value="${startDate || ''}" placeholder="ì˜ˆ: 2024-01-01">
                </div>
                <div class="form-group">
                    <label>ì¢…ë£Œì¼</label>
                    <input type="text" id="edit-activity-end" value="${endDate || ''}" placeholder="ì˜ˆ: 2024-12-31">
                </div>
                <div class="form-group">
                    <label>ë‚´ìš©</label>
                    <textarea id="edit-activity-desc">${desc || ''}</textarea>
                </div>
                ${getCustomFieldsHTML(extra)}
            `;
            document.getElementById('modal').classList.add('active');
        }

        // í™œë™ ì‚­ì œ
        function deleteActivity(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                fetch(`/api/activities/${id}`, {method: 'DELETE'})
                .then(r => r.json())
                .then(data => {
                    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadActivities();
                });
            }
        }

        // í”„ë¡œì íŠ¸ ë¡œë“œ
        function loadProjects() {
            fetch('/api/projects')
                .then(r => r.json())
                .then(data => {
                    let html = '';
                    data.forEach((proj, idx) => {
                        const name = (proj.name || '').replace(/'/g, "\\'");
                        const role = (proj.role || '').replace(/'/g, "\\'");
                        const desc = (proj.description || '').replace(/'/g, "\\'");
                        const tech = Array.isArray(proj.tech_stack) ? proj.tech_stack.join(', ') : '';
                        const extraFields = (proj.extra_fields || '{}').replace(/'/g, "\\'");
                        html += `
                            <tr>
                                <td>${idx + 1}</td>
                                <td>${proj.name}</td>
                                <td>${proj.date}</td>
                                <td>${proj.team_size || '-'}</td>
                                <td>${proj.role || '-'}</td>
                                <td>${tech || '-'}</td>
                                <td>${proj.description || '-'}</td>
                                <td>
                                    <button class="btn-edit" onclick="editProject(${proj.id}, '${name}', '${proj.date}', '${proj.team_size || ''}', '${role}', '${desc}', '${extraFields}')">ìˆ˜ì •</button>
                                    <button class="btn-delete" onclick="deleteProject(${proj.id})">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `;
                    });
                    document.getElementById('projects-tbody').innerHTML = html;
                });
        }

        // í”„ë¡œì íŠ¸ ìˆ˜ì •
        function editProject(id, name, date, teamSize, role, desc, extraFields = '{}') {
            currentEditType = 'project-edit';
            currentEditId = id;
            customFieldCounter = 0;

            let extra = {};
            try { extra = JSON.parse(extraFields || '{}'); } catch(e) {}

            document.getElementById('modal-title').textContent = 'í”„ë¡œì íŠ¸ ìˆ˜ì •';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>í”„ë¡œì íŠ¸ëª…</label>
                    <input type="text" id="edit-project-name" value="${name || ''}">
                </div>
                <div class="form-group">
                    <label>ê¸°ê°„</label>
                    <input type="text" id="edit-project-date" value="${date || ''}" placeholder="ì˜ˆ: 2024-01 ~ 2024-06">
                </div>
                <div class="form-group">
                    <label>ì¸ì›</label>
                    <input type="text" id="edit-project-team" value="${teamSize || ''}" placeholder="ì˜ˆ: 4ëª…">
                </div>
                <div class="form-group">
                    <label>ì—­í• </label>
                    <input type="text" id="edit-project-role" value="${role || ''}" placeholder="ì˜ˆ: ë°±ì—”ë“œ ê°œë°œ">
                </div>
                <div class="form-group">
                    <label>ì„¤ëª…</label>
                    <textarea id="edit-project-desc">${desc || ''}</textarea>
                </div>
                ${getCustomFieldsHTML(extra)}
            `;
            document.getElementById('modal').classList.add('active');
        }

        // í”„ë¡œì íŠ¸ ì‚­ì œ
        function deleteProject(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                fetch(`/api/projects/${id}`, {method: 'DELETE'})
                .then(r => r.json())
                .then(data => {
                    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadProjects();
                });
            }
        }

        // ê²½ë ¥ ë¡œë“œ
        function loadCareer() {
            fetch('/api/career')
                .then(r => r.json())
                .then(data => {
                    let html = '';
                    data.forEach((career, idx) => {
                        const company = (career.company || '').replace(/'/g, "\\'");
                        const position = (career.position || '').replace(/'/g, "\\'");
                        const desc = (career.description || '').replace(/'/g, "\\'");
                        const extraFields = (career.extra_fields || '{}').replace(/'/g, "\\'");
                        html += `
                            <tr>
                                <td>${idx + 1}</td>
                                <td>${career.company}</td>
                                <td>${career.position}</td>
                                <td>${career.start_date}</td>
                                <td>${career.end_date}</td>
                                <td>${career.description || '-'}</td>
                                <td>
                                    <button class="btn-edit" onclick="editCareer(${career.id}, '${company}', '${position}', '${career.start_date}', '${career.end_date}', '${desc}', '${extraFields}')">ìˆ˜ì •</button>
                                    <button class="btn-delete" onclick="deleteCareer(${career.id})">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `;
                    });
                    document.getElementById('career-tbody').innerHTML = html;
                });
        }

        // ê²½ë ¥ ìˆ˜ì •
        function editCareer(id, company, position, startDate, endDate, desc, extraFields = '{}') {
            currentEditType = 'career-edit';
            currentEditId = id;
            customFieldCounter = 0;

            let extra = {};
            try { extra = JSON.parse(extraFields || '{}'); } catch(e) {}

            document.getElementById('modal-title').textContent = 'ê²½ë ¥ ìˆ˜ì •';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>ê¸°ì—…ëª…</label>
                    <input type="text" id="edit-career-company" value="${company || ''}">
                </div>
                <div class="form-group">
                    <label>ì§ê¸‰</label>
                    <input type="text" id="edit-career-position" value="${position || ''}">
                </div>
                <div class="form-group">
                    <label>ì…ì‚¬ì¼</label>
                    <input type="text" id="edit-career-start" value="${startDate || ''}" placeholder="ì˜ˆ: 2023-05-01">
                </div>
                <div class="form-group">
                    <label>í‡´ì‚¬ì¼</label>
                    <input type="text" id="edit-career-end" value="${endDate || ''}" placeholder="ì˜ˆ: 2025-05-31">
                </div>
                <div class="form-group">
                    <label>ë‹´ë‹¹ì—…ë¬´</label>
                    <textarea id="edit-career-desc">${desc || ''}</textarea>
                </div>
                ${getCustomFieldsHTML(extra)}
            `;
            document.getElementById('modal').classList.add('active');
        }

        // ê²½ë ¥ ì‚­ì œ
        function deleteCareer(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                fetch(`/api/career/${id}`, {method: 'DELETE'})
                .then(r => r.json())
                .then(data => {
                    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadCareer();
                });
            }
        }

        // ==================== ìì†Œì„œ ë¬¸í•­ ê´€ë¦¬ (DB ê¸°ë°˜) ====================
        function loadCoverLettersFromDB() {
            const category = document.getElementById('cover-letter-filter').value;
            const url = category ? `/api/cover-letters?category=${encodeURIComponent(category)}` : '/api/cover-letters';

            fetch(url)
                .then(r => r.json())
                .then(data => {
                    const list = document.getElementById('cover-letter-list');
                    if (data.length === 0) {
                        list.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">ë“±ë¡ëœ ìì†Œì„œ ë¬¸í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                        return;
                    }

                    let html = '';
                    data.forEach((item) => {
                        const company = (item.company || '').replace(/'/g, "\\'");
                        const position = (item.position || '').replace(/'/g, "\\'");
                        const question = (item.question || '').replace(/'/g, "\\'");
                        const answer = (item.answer || '').replace(/'/g, "\\'");
                        const extraFields = (item.extra_fields || '{}').replace(/'/g, "\\'");
                        html += `
                            <div class="cover-letter-item" style="background:#fff;border:1px solid #ddd;border-radius:8px;padding:20px;margin-bottom:15px;">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                                    <h3 style="margin:0;color:#333;">${item.company} - ${item.position}</h3>
                                    <span style="background:#e3f2fd;color:#1976d2;padding:4px 12px;border-radius:20px;font-size:12px;">${item.category}</span>
                                </div>
                                <div style="color:#666;font-size:13px;margin-bottom:10px;">
                                    ${item.char_limit ? `ê¸€ììˆ˜ ì œí•œ: ${item.char_limit}ì | ` : ''}
                                    ì‘ì„±ì¼: ${item.created_at ? item.created_at.split(' ')[0] : '-'}
                                </div>
                                <div style="background:#f5f5f5;padding:10px;border-radius:4px;margin-bottom:10px;">
                                    <strong>ë¬¸í•­:</strong> ${item.question}
                                </div>
                                <textarea id="answer-${item.id}" style="width:100%;min-height:150px;padding:10px;border:1px solid #ddd;border-radius:4px;resize:vertical;"
                                    onblur="saveCoverLetterAnswer(${item.id})">${item.answer || ''}</textarea>
                                <div style="margin-top:10px;display:flex;gap:10px;">
                                    <button class="btn-edit" onclick="editCoverLetter(${item.id}, '${company}', '${position}', '${item.category}', '${question}', ${item.char_limit || 0}, '${extraFields}')">ìˆ˜ì •</button>
                                    <button class="btn-delete" onclick="deleteCoverLetterFromDB(${item.id})">ì‚­ì œ</button>
                                    <span style="margin-left:auto;color:#999;font-size:12px;" id="char-count-${item.id}"></span>
                                </div>
                            </div>
                        `;
                    });
                    list.innerHTML = html;

                    // ê¸€ììˆ˜ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
                    data.forEach(item => {
                        updateCharCount(item.id);
                        document.getElementById(`answer-${item.id}`).addEventListener('input', () => updateCharCount(item.id));
                    });
                });
        }

        function updateCharCount(id) {
            const textarea = document.getElementById(`answer-${id}`);
            const countSpan = document.getElementById(`char-count-${id}`);
            if (textarea && countSpan) {
                countSpan.textContent = `í˜„ì¬ ${textarea.value.length}ì`;
            }
        }

        function filterCoverLetters() {
            loadCoverLettersFromDB();
        }

        function openAddCoverLetterModal() {
            currentEditType = 'cover-letter-add';
            customFieldCounter = 0;

            document.getElementById('modal-title').textContent = 'ìì†Œì„œ ë¬¸í•­ ì¶”ê°€';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>íšŒì‚¬ëª…</label>
                    <input type="text" id="edit-cl-company" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì">
                </div>
                <div class="form-group">
                    <label>ì§ë¬´</label>
                    <input type="text" id="edit-cl-position" placeholder="ì˜ˆ: ë°ì´í„° ë¶„ì„ê°€">
                </div>
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬</label>
                    <select id="edit-cl-category">
                        <option value="ì§€ì›ë™ê¸°">ì§€ì›ë™ê¸°</option>
                        <option value="ì„±ì¥ê³¼ì •">ì„±ì¥ê³¼ì •</option>
                        <option value="ì„±ê²©/ì¥ë‹¨ì ">ì„±ê²©/ì¥ë‹¨ì </option>
                        <option value="ê°ˆë“±ê²½í—˜">ê°ˆë“±ê²½í—˜</option>
                        <option value="í˜‘ì—…ê²½í—˜">í˜‘ì—…ê²½í—˜</option>
                        <option value="ë¬¸ì œí•´ê²°">ë¬¸ì œí•´ê²°</option>
                        <option value="ì‹¤íŒ¨ê²½í—˜">ì‹¤íŒ¨ê²½í—˜</option>
                        <option value="ëª©í‘œ/ë¹„ì „">ëª©í‘œ/ë¹„ì „</option>
                        <option value="ì§ë¬´ì—­ëŸ‰">ì§ë¬´ì—­ëŸ‰</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ë¬¸í•­ ë‚´ìš©</label>
                    <textarea id="edit-cl-question" placeholder="ì˜ˆ: ì§€ì›ë™ê¸°ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”." style="min-height:80px;"></textarea>
                </div>
                <div class="form-group">
                    <label>ê¸€ììˆ˜ ì œí•œ (ì„ íƒ)</label>
                    <input type="number" id="edit-cl-char-limit" placeholder="ì˜ˆ: 500">
                </div>
                ${getCustomFieldsHTML({})}
            `;
            document.getElementById('modal').classList.add('active');
        }

        function editCoverLetter(id, company, position, category, question, charLimit, extraFields = '{}') {
            currentEditType = 'cover-letter-edit';
            currentEditId = id;
            customFieldCounter = 0;

            let extra = {};
            try { extra = JSON.parse(extraFields || '{}'); } catch(e) {}

            document.getElementById('modal-title').textContent = 'ìì†Œì„œ ë¬¸í•­ ìˆ˜ì •';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>íšŒì‚¬ëª…</label>
                    <input type="text" id="edit-cl-company" value="${company || ''}">
                </div>
                <div class="form-group">
                    <label>ì§ë¬´</label>
                    <input type="text" id="edit-cl-position" value="${position || ''}">
                </div>
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬</label>
                    <select id="edit-cl-category">
                        <option value="ì§€ì›ë™ê¸°" ${category === 'ì§€ì›ë™ê¸°' ? 'selected' : ''}>ì§€ì›ë™ê¸°</option>
                        <option value="ì„±ì¥ê³¼ì •" ${category === 'ì„±ì¥ê³¼ì •' ? 'selected' : ''}>ì„±ì¥ê³¼ì •</option>
                        <option value="ì„±ê²©/ì¥ë‹¨ì " ${category === 'ì„±ê²©/ì¥ë‹¨ì ' ? 'selected' : ''}>ì„±ê²©/ì¥ë‹¨ì </option>
                        <option value="ê°ˆë“±ê²½í—˜" ${category === 'ê°ˆë“±ê²½í—˜' ? 'selected' : ''}>ê°ˆë“±ê²½í—˜</option>
                        <option value="í˜‘ì—…ê²½í—˜" ${category === 'í˜‘ì—…ê²½í—˜' ? 'selected' : ''}>í˜‘ì—…ê²½í—˜</option>
                        <option value="ë¬¸ì œí•´ê²°" ${category === 'ë¬¸ì œí•´ê²°' ? 'selected' : ''}>ë¬¸ì œí•´ê²°</option>
                        <option value="ì‹¤íŒ¨ê²½í—˜" ${category === 'ì‹¤íŒ¨ê²½í—˜' ? 'selected' : ''}>ì‹¤íŒ¨ê²½í—˜</option>
                        <option value="ëª©í‘œ/ë¹„ì „" ${category === 'ëª©í‘œ/ë¹„ì „' ? 'selected' : ''}>ëª©í‘œ/ë¹„ì „</option>
                        <option value="ì§ë¬´ì—­ëŸ‰" ${category === 'ì§ë¬´ì—­ëŸ‰' ? 'selected' : ''}>ì§ë¬´ì—­ëŸ‰</option>
                        <option value="ê¸°íƒ€" ${category === 'ê¸°íƒ€' ? 'selected' : ''}>ê¸°íƒ€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ë¬¸í•­ ë‚´ìš©</label>
                    <textarea id="edit-cl-question" style="min-height:80px;">${question || ''}</textarea>
                </div>
                <div class="form-group">
                    <label>ê¸€ììˆ˜ ì œí•œ (ì„ íƒ)</label>
                    <input type="number" id="edit-cl-char-limit" value="${charLimit || ''}">
                </div>
                ${getCustomFieldsHTML(extra)}
            `;
            document.getElementById('modal').classList.add('active');
        }

        function saveCoverLetterAnswer(id) {
            const answer = document.getElementById(`answer-${id}`).value;
            fetch(`/api/cover-letters/${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    answer: answer,
                    company: '', position: '', category: '', question: '' // í•„ìˆ˜ í•„ë“œ (ì„œë²„ì—ì„œ ë¬´ì‹œë¨)
                })
            }).then(r => r.json()).then(() => {
                // ì¡°ìš©íˆ ì €ì¥ (alert ì—†ì´)
            });
        }

        function deleteCoverLetterFromDB(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                fetch(`/api/cover-letters/${id}`, {method: 'DELETE'})
                    .then(r => r.json())
                    .then(data => {
                        alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                        loadCoverLettersFromDB();
                    });
            }
        }

        // í‘œ ë³µì‚¬
        function copyTable(tableId) {
            const table = document.getElementById(tableId);
            const range = document.createRange();
            range.selectNode(table);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
            alert('âœ… í‘œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ì—‘ì…€ì´ë‚˜ ì›Œë“œì— Ctrl+Vë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.');
        }

        // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        function downloadExcel(type) {
            const tableIds = {
                'grades': 'grades-table',
                'certifications': 'cert-table',
                'awards': 'awards-table',
                'activities': 'activities-table',
                'projects': 'projects-table',
                'career': 'career-table'
            };
            const filenames = {
                'grades': 'ì–‘í•œë¹ˆ_ì„±ì .xls',
                'certifications': 'ì–‘í•œë¹ˆ_ìê²©ì¦.xls',
                'awards': 'ì–‘í•œë¹ˆ_ìˆ˜ìƒ.xls',
                'activities': 'ì–‘í•œë¹ˆ_í™œë™.xls',
                'projects': 'ì–‘í•œë¹ˆ_í”„ë¡œì íŠ¸.xls',
                'career': 'ì–‘í•œë¹ˆ_ê²½ë ¥.xls'
            };

            const table = document.getElementById(tableIds[type]);
            const html = table.outerHTML;
            const url = 'data:application/vnd.ms-excel,' + encodeURIComponent(html);
            const link = document.createElement('a');
            link.href = url;
            link.download = filenames[type];
            link.click();
        }

        // ==================== ì•„ì¹´ì´ë¸Œ ê´€ë¦¬ ====================
        function loadArchives() {
            const category = document.getElementById('archive-filter').value;
            const url = category ? `/api/archives?category=${encodeURIComponent(category)}` : '/api/archives';

            fetch(url)
                .then(r => r.json())
                .then(data => {
                    let html = '';
                    if (data.length === 0) {
                        html = '<tr><td colspan="7" style="text-align:center;color:#999;">ë“±ë¡ëœ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    } else {
                        data.forEach((arch, idx) => {
                            const name = (arch.name || '').replace(/'/g, "\\'");
                            const desc = (arch.description || '').replace(/'/g, "\\'");
                            html += `
                                <tr>
                                    <td>${idx + 1}</td>
                                    <td>${arch.name}</td>
                                    <td>${arch.category}</td>
                                    <td>${arch.original_filename || '-'}</td>
                                    <td>${arch.description || '-'}</td>
                                    <td>${arch.upload_date ? arch.upload_date.split(' ')[0] : '-'}</td>
                                    <td class="action-cell">
                                        <button class="btn btn-small btn-primary" onclick="downloadArchive(${arch.id})">ë‹¤ìš´ë¡œë“œ</button>
                                        <button class="btn btn-small" onclick="editArchive(${arch.id}, '${name}', '${arch.category}', '${desc}')">ìˆ˜ì •</button>
                                        <button class="btn btn-small btn-danger" onclick="deleteArchive(${arch.id})">ì‚­ì œ</button>
                                    </td>
                                </tr>
                            `;
                        });
                    }
                    document.getElementById('archives-tbody').innerHTML = html;
                });
        }

        function filterArchives() {
            loadArchives();
        }

        function openArchiveUploadModal() {
            currentEditType = 'archive-add';
            document.getElementById('modal-title').textContent = 'íŒŒì¼ ì—…ë¡œë“œ';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>íŒŒì¼ ì„ íƒ</label>
                    <input type="file" id="archive-file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx,.hwp">
                </div>
                <div class="form-group">
                    <label>ë¬¸ì„œëª…</label>
                    <input type="text" id="archive-name" placeholder="ì˜ˆ: 2025ë…„ ì„±ì ì¦ëª…ì„œ">
                </div>
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬</label>
                    <select id="archive-category">
                        <option value="ì„±ì ì¦ëª…ì„œ">ì„±ì ì¦ëª…ì„œ</option>
                        <option value="ì¡¸ì—…ì¦ëª…ì„œ">ì¡¸ì—…ì¦ëª…ì„œ</option>
                        <option value="ìˆ˜ë£Œì¦">ìˆ˜ë£Œì¦</option>
                        <option value="ìê²©ì¦">ìê²©ì¦</option>
                        <option value="ì¬ì§ì¦ëª…ì„œ">ì¬ì§ì¦ëª…ì„œ</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì„¤ëª… (ì„ íƒ)</label>
                    <textarea id="archive-desc" placeholder="ë¬¸ì„œì— ëŒ€í•œ ì„¤ëª…"></textarea>
                </div>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function editArchive(id, name, category, desc) {
            currentEditType = 'archive-edit';
            currentEditId = id;

            document.getElementById('modal-title').textContent = 'ì•„ì¹´ì´ë¸Œ ìˆ˜ì •';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>ë¬¸ì„œëª…</label>
                    <input type="text" id="archive-name" value="${name || ''}">
                </div>
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬</label>
                    <select id="archive-category">
                        <option value="ì„±ì ì¦ëª…ì„œ" ${category === 'ì„±ì ì¦ëª…ì„œ' ? 'selected' : ''}>ì„±ì ì¦ëª…ì„œ</option>
                        <option value="ì¡¸ì—…ì¦ëª…ì„œ" ${category === 'ì¡¸ì—…ì¦ëª…ì„œ' ? 'selected' : ''}>ì¡¸ì—…ì¦ëª…ì„œ</option>
                        <option value="ìˆ˜ë£Œì¦" ${category === 'ìˆ˜ë£Œì¦' ? 'selected' : ''}>ìˆ˜ë£Œì¦</option>
                        <option value="ìê²©ì¦" ${category === 'ìê²©ì¦' ? 'selected' : ''}>ìê²©ì¦</option>
                        <option value="ì¬ì§ì¦ëª…ì„œ" ${category === 'ì¬ì§ì¦ëª…ì„œ' ? 'selected' : ''}>ì¬ì§ì¦ëª…ì„œ</option>
                        <option value="ê¸°íƒ€" ${category === 'ê¸°íƒ€' ? 'selected' : ''}>ê¸°íƒ€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì„¤ëª…</label>
                    <textarea id="archive-desc">${desc || ''}</textarea>
                </div>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function downloadArchive(id) {
            window.location.href = `/api/archives/${id}/download`;
        }

        function deleteArchive(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? íŒŒì¼ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) {
                fetch(`/api/archives/${id}`, {method: 'DELETE'})
                    .then(r => r.json())
                    .then(data => {
                        alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                        loadArchives();
                    });
            }
        }

        // ==================== ì»¤ìŠ¤í…€ í•„ë“œ ê´€ë¦¬ ====================
        let customFieldCounter = 0;

        function getCustomFieldsHTML(existingFields = {}) {
            let fieldsHTML = '';
            for (const [key, value] of Object.entries(existingFields)) {
                fieldsHTML += `
                    <div class="custom-field-row" id="custom-field-${customFieldCounter}">
                        <input type="text" class="field-name" value="${key}" placeholder="í•„ë“œëª…">
                        <input type="text" class="field-value" value="${value}" placeholder="ê°’">
                        <button type="button" class="btn-remove-field" onclick="removeCustomField(${customFieldCounter})">ì‚­ì œ</button>
                    </div>
                `;
                customFieldCounter++;
            }
            return `
                <div class="custom-fields-container">
                    <div class="custom-fields-title">ì¶”ê°€ í•„ë“œ (ì„ íƒì‚¬í•­)</div>
                    <div id="custom-fields-list">${fieldsHTML}</div>
                    <button type="button" class="btn-add-field" onclick="addCustomField()">+ í•„ë“œ ì¶”ê°€</button>
                </div>
            `;
        }

        function addCustomField() {
            const container = document.getElementById('custom-fields-list');
            const fieldHTML = `
                <div class="custom-field-row" id="custom-field-${customFieldCounter}">
                    <input type="text" class="field-name" placeholder="í•„ë“œëª… (ì˜ˆ: ì‘ì‹œì¼ì)">
                    <input type="text" class="field-value" placeholder="ê°’ (ì˜ˆ: 2025-12-01)">
                    <button type="button" class="btn-remove-field" onclick="removeCustomField(${customFieldCounter})">ì‚­ì œ</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', fieldHTML);
            customFieldCounter++;
        }

        function removeCustomField(id) {
            const field = document.getElementById(`custom-field-${id}`);
            if (field) field.remove();
        }

        function collectCustomFields() {
            const fields = {};
            const rows = document.querySelectorAll('#custom-fields-list .custom-field-row');
            rows.forEach(row => {
                const name = row.querySelector('.field-name').value.trim();
                const value = row.querySelector('.field-value').value.trim();
                if (name && value) {
                    fields[name] = value;
                }
            });
            return Object.keys(fields).length > 0 ? JSON.stringify(fields) : null;
        }

        // localStorage â†’ DB ë§ˆì´ê·¸ë ˆì´ì…˜ (ìì†Œì„œ ë¬¸í•­)
        async function migrateCoverLetters() {
            const localData = localStorage.getItem('coverLetters');
            if (!localData) return;

            try {
                const coverLetters = JSON.parse(localData);
                if (coverLetters.length === 0) return;

                console.log(`ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘: ${coverLetters.length}ê°œ ë¬¸í•­`);

                for (const item of coverLetters) {
                    const data = {
                        company: item.company || '',
                        position: item.position || '',
                        category: 'ê¸°íƒ€',  // ê¸°ì¡´ ë°ì´í„°ì—ëŠ” ì¹´í…Œê³ ë¦¬ê°€ ì—†ìœ¼ë¯€ë¡œ ê¸°ë³¸ê°’
                        question: item.question || '',
                        answer: item.answer || '',
                        char_limit: null
                    };

                    await fetch('/api/cover-letters', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(data)
                    });
                }

                // ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„ localStorage ë°ì´í„° ë°±ì—… í›„ ì‚­ì œ
                localStorage.setItem('coverLetters_backup', localData);
                localStorage.removeItem('coverLetters');

                alert(`âœ… ${coverLetters.length}ê°œì˜ ìì†Œì„œ ë¬¸í•­ì´ DBë¡œ ì´ì „ë˜ì—ˆìŠµë‹ˆë‹¤!\n(ê¸°ì¡´ ë°ì´í„°ëŠ” coverLetters_backupì— ë°±ì—…ë¨)`);
                console.log('ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ');
            } catch (e) {
                console.error('ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:', e);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„±ì  ë°ì´í„° í‘œì‹œ
        window.onload = function() {
            loadGrades();
            migrateCoverLetters();  // ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
        };
    </script>
</body>
</html>
